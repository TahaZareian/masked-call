; کانفیگ SIP Trunk از Docker Asterisk به سرور Asterisk خارجی
; این فایل را به sip.conf اضافه کنید یا در asterisk.conf include کنید
; 
; دو روش برای اتصال:
; 1. Peer (سرور خارجی به Docker می‌فرستد)
; 2. Register (Docker به سرور خارجی متصل می‌شود)

; ============================================
; روش 1: Peer - سرور خارجی به Docker وصل می‌شود
; ============================================
; در این روش، سرور Asterisk خارجی شما باید کانفیگ داشته باشد که به Docker وصل شود:
; 
; [docker-asterisk]
; type=peer
; host=IP_DOCKER_SERVER
; port=5060
; context=from-internal
;
; و در Docker Asterisk (این فایل):

[from-external-server]
; این peer برای دریافت ترانک از سرور خارجی است
type=peer
host=IP_EXTERNAL_ASTERISK_SERVER  ; IP سرور Asterisk خارجی شما
port=5060
context=from-internal
; اگر سرور خارجی authentication نیاز دارد:
; username=trunk_username
; secret=trunk_password
; اگر می‌خواهید authentication نداشته باشد (فقط IP check):
; insecure=port,invite
canreinvite=no
dtmfmode=rfc2833
disallow=all
allow=ulaw
allow=alaw

; ============================================
; روش 2: Register - Docker به سرور خارجی متصل می‌شود (پیشنهادی)
; ============================================
; این روش بهتر است چون:
; - در NAT بهتر کار می‌کند
; - سرور خارجی نیازی به دانستن IP Docker ندارد
; - Docker خودش را register می‌کند

[external-server-trunk]
type=peer
host=IP_EXTERNAL_ASTERISK_SERVER  ; IP یا hostname سرور خارجی
username=your_trunk_username      ; نام کاربری trunk در سرور خارجی
secret=your_trunk_password        ; رمز عبور trunk
fromuser=your_trunk_username       ; شماره فرستنده
fromdomain=your_domain.com         ; domain شما
context=from-internal
canreinvite=no
dtmfmode=rfc2833
disallow=all
allow=ulaw
allow=alaw
qualify=yes

; ثبت‌نام خودکار (Register)
; این خط را در بخش [general] فایل sip.conf اضافه کنید:
; register => username:password@IP_EXTERNAL_SERVER/external-server-trunk

; یا در asterisk CLI دستور بزنید:
; sip register external-server-trunk username password IP_EXTERNAL_SERVER

; ============================================
; نکات مهم:
; ============================================
; 
; 1. اگر سرور Docker شما پشت NAT است، باید:
;    - در sip.conf: externip=IP_PUBLIC_DOCKER_SERVER
;    - در sip.conf: localnet=192.168.0.0/255.255.0.0 (IP range داخلی)
;
; 2. در سرور Asterisk خارجی، باید peer یا user تعریف کنید:
;    [docker-asterisk]
;    type=peer
;    host=IP_DOCKER_SERVER
;    secret=password
;    context=from-internal
;
; 3. برای test کردن:
;    - در Docker Asterisk: sip show peers
;    - در Docker Asterisk: sip show registry
;    - در سرور خارجی: sip show peers

