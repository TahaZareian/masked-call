# Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ - Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§ ØªØ±Ø§Ù†Ú© SIP

## ðŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø´Ù…Ø§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Ø³Ø±ÙˆØ± Docker (Ù‡Ù…Ø±ÙˆØ´)              â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Ø³Ø±ÙˆÛŒØ³ ÙˆØ¨ (FastAPI)               â”‚   â”‚
â”‚  â”‚  Port: 8000                        â”‚   â”‚
â”‚  â”‚                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â†’ AMI (5038)                   â”‚   â”‚
â”‚  â”‚  â””â”€â†’ PostgreSQL (Ù‡Ù…Ø±ÙˆØ´)          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Asterisk Ø¯Ø± Docker                â”‚   â”‚
â”‚  â”‚  Ports:                             â”‚   â”‚
â”‚  â”‚  - 5060 (SIP/UDP/TCP)              â”‚   â”‚
â”‚  â”‚  - 5038 (AMI)                      â”‚   â”‚
â”‚  â”‚                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â†’ SIP Trunk â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â†’ Ø³Ø±ÙˆØ± Asterisk Ø®Ø§Ø±Ø¬ÛŒ
â”‚  â”‚  â””â”€â†’ AMI â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  (Ø¨Ø§ Ø®Ø·ÙˆØ· ÙÛŒØ²ÛŒÚ©ÛŒ)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Ø³Ø±ÙˆØ± Asterisk Ø®Ø§Ø±Ø¬ÛŒ                â”‚
â”‚                                          â”‚
â”‚  - Ø®Ø·ÙˆØ· ÙÛŒØ²ÛŒÚ©ÛŒ (PRI/T1/E1)             â”‚
â”‚  - SIP Trunk â†’ Docker Asterisk         â”‚
â”‚  - ÛŒØ§: Docker Asterisk â†’ Ø§ÛŒÙ† Ø³Ø±ÙˆØ±       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ø±

1. **Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªÙ…Ø§Ø³:**
   - Ú©Ø§Ø±Ø¨Ø± â†’ API (Ø³Ø±ÙˆÛŒØ³ ÙˆØ¨) â†’ Ø§ÛŒØ¬Ø§Ø¯ session Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³

2. **Ø§ÛŒØ¬Ø§Ø¯ ØªÙ…Ø§Ø³:**
   - Ø³Ø±ÙˆÛŒØ³ ÙˆØ¨ â†’ AMI (Asterisk Docker) â†’ ÙØ±Ù…Ø§Ù† Originate

3. **Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ ØªÙ…Ø§Ø³:**
   - Asterisk Docker â†’ SIP Trunk â†’ Ø³Ø±ÙˆØ± Asterisk Ø®Ø§Ø±Ø¬ÛŒ â†’ Ø®Ø·ÙˆØ· ÙÛŒØ²ÛŒÚ©ÛŒ

4. **Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§:**
   - Asterisk Docker â†’ AMI Events â†’ Ø³Ø±ÙˆÛŒØ³ ÙˆØ¨ â†’ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³

## âš™ï¸ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…

### Û±. Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø§Ø±Ø¬ÛŒ (Ù‡Ù…Ø±ÙˆØ´)

Ø¯Ø± `docker-compose.yml` Ø¨Ø§ÛŒØ¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù…Ø­Ù„ÛŒ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø§Ø±Ø¬ÛŒ ÙˆØµÙ„ Ø´ÙˆÛŒØ¯.

### Û². Asterisk Ø¯Ø± Docker

Asterisk Ø¯Ø± Docker Ø¨Ø§ÛŒØ¯:
- Ù¾ÙˆØ±Øª SIP (5060) Ø±Ø§ Ø¨Ù‡ Ø¨ÛŒØ±ÙˆÙ† Ø¨Ø§Ø² Ú©Ù†Ø¯
- Ú©Ø§Ù†ÙÛŒÚ¯ SIP Trunk Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ ØªØ§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø®Ø§Ø±Ø¬ÛŒ ÙˆØµÙ„ Ø´ÙˆØ¯

### Û³. Ø³Ø±ÙˆØ± Asterisk Ø®Ø§Ø±Ø¬ÛŒ

Ø¨Ø§ÛŒØ¯ SIP Trunk ØªØ¹Ø±ÛŒÙ Ú©Ù†Ø¯ Ú©Ù‡:
- Ø¨Ù‡ IP Ø³Ø±ÙˆØ± Docker ÙˆØµÙ„ Ø´ÙˆØ¯
- ÛŒØ§ Ø§ÛŒÙ†Ú©Ù‡ Docker Asterisk Ø¨Ù‡ Ø¢Ù† Ø³Ø±ÙˆØ± ÙˆØµÙ„ Ø´ÙˆØ¯ (register)

## ðŸ“ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

### Ø¬Ù‡Øª ØªØ±Ø§Ù†Ú© SIP:

Ø¯Ùˆ Ø­Ø§Ù„Øª Ø¯Ø§Ø±ÛŒØ¯:

#### Ø­Ø§Ù„Øª 1: Ø³Ø±ÙˆØ± Ø®Ø§Ø±Ø¬ÛŒ â†’ Docker Asterisk (Inbound)
Ø³Ø±ÙˆØ± Ø®Ø§Ø±Ø¬ÛŒ ØªØ±Ø§Ù†Ú© Ø±Ø§ Ø¨Ù‡ Docker Asterisk Ù…ÛŒâ€ŒÙØ±Ø³ØªØ¯.

**Ù…Ø²Ø§ÛŒØ§:**
- Docker Asterisk ÙÙ‚Ø· Ú¯ÙˆØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø§Ø¯Ù‡â€ŒØªØ±

**Ú©Ø§Ù†ÙÛŒÚ¯ Ø³Ø±ÙˆØ± Ø®Ø§Ø±Ø¬ÛŒ:**
```
[trunk-to-docker]
type=peer
host=IP_DOCKER_SERVER
port=5060
context=from-internal
```

#### Ø­Ø§Ù„Øª 2: Docker Asterisk â†’ Ø³Ø±ÙˆØ± Ø®Ø§Ø±Ø¬ÛŒ (Outbound Register)
Docker Asterisk Ø®ÙˆØ¯Ø´ Ø±Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø®Ø§Ø±Ø¬ÛŒ Ø«Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

**Ù…Ø²Ø§ÛŒØ§:**
- Ú©Ù†ØªØ±Ù„ Ø¨ÛŒØ´ØªØ± Ø§Ø² Docker
- Ù…Ù†Ø§Ø³Ø¨â€ŒØªØ± Ø¨Ø±Ø§ÛŒ NAT

**Ú©Ø§Ù†ÙÛŒÚ¯ Docker Asterisk:**
```
[external-server]
type=peer
host=IP_EXTERNAL_SERVER
username=...
secret=...
register => username:password@IP_EXTERNAL_SERVER/external-server
```

### Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯:
Ø§Ú¯Ø± Ø³Ø±ÙˆØ± Docker Ø´Ù…Ø§ Ù¾Ø´Øª NAT Ù†ÛŒØ³Øª Ùˆ IP Ø¹Ù…ÙˆÙ…ÛŒ Ø¯Ø§Ø±Ø¯ØŒ **Ø­Ø§Ù„Øª 1** Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ø§Ø³Øª.
Ø§Ú¯Ø± NAT Ø¯Ø§Ø±ÛŒØ¯ØŒ **Ø­Ø§Ù„Øª 2** (register) Ø¨Ù‡ØªØ± Ø§Ø³Øª.

